{% extends 'mycartadmin/admin_base.html' %}
{% load static %}
{% load humanize %}
{% block pagename %} Offer Management {% endblock %}
{% block contents %}
<div class="d-flex justify-content-between">
  <div class="text-right mb-3 mr-3"><hr><a href="{% url 'add_coupon' %}" class="btn btn-primary"> Add Coupon </a></div>
  <div class="text-right mb-3 mr-3"><hr><a href="{% url 'add_product_offer' %}" class="btn btn-primary"> Add Product Offer</a></div>
  <div class="text-right mb-3 mr-3"><hr><a href="{% url 'add_cat_offer' %}" class="btn btn-primary"> Add Category Offer</a></div>
</div>
          
<!-- {% include 'includes/alerts.html' %} -->

<div class="card mb-4">
  <div class="card-header">
      <i class="fas fa-table me-1"></i>
      Coupon Offers
  </div>
  <div class="card-body"> 
      <table id="datatablesSimple">
          <thead>
              <tr>
                <th>Coupon Code</th>
                  <th>Valid From</th>
                  <th>Valid To</th>
                  <th>Discount</th>
                  <th>Edit</th>
                <th scope="col">Block/Activate</th>
                <!-- <th>Edit User</th> -->
                <th scope="col">Delete Coupon</th>
              </tr>
          </thead>
          <tfoot>
              <tr>
                <th>Coupon Code</th>
                  <th>Valid From</th>
                  <th>Valid To</th>
                  <th>Discount</th>
                  <th>Edit</th>
                <th scope="col">Block/Activate</th>
                <!-- <th>Edit User</th> -->
                <th scope="col">Delete Coupon</th>
              </tr>
          </tfoot>
          <tbody>
         
               {% for offer in coupon_offers %}
            <tr>
          
               <td>{{offer.code}}</td>
              <td>{{offer.valid_from | naturaltime}}</td>
              <td>{{offer.valid_to | naturaltime}}</td>
              <td>{{offer.discount}}</td>
              <td> <a href="{% url 'edit_coupon' offer.id %}" class="btn btn-primary">Edit</a></td>
              {% if offer.active %}
              <td><a class="confirm-block" id="blockCouponBtn"
                onclick="blockCoupon('{{offer.id}}')">
                <button class="btn btn-warning"> <i class="icon-ban-circle"></i>Deactivate</button> </a></td>
              {% else %}
              <td><a class="confirm-activate" id="actCouponBtn" onclick="actCoupon('{{offer.id}}')"><button class="btn btn-success"> <i class="icon-play"></i>Activate</button></a></td>
              {% endif %}
              <!-- <td><a href="admin_user_edit/{{user.id}}" onclick="return confirm('Are you sure you want to EDIT this user?')"><button class="btn btn-primary "> <i class="icon-edit"></i> Edit</button></a></td> -->
              <td><a  class="confirm-delete" id="delCouponBtn" onclick="delCoupon('{{offer.id}}')" >  <button class="btn btn-danger"> <i class="icon-trash"></i> Delete </button></a></td>
              <!-- <td class="center">4</td> -->
            </tr>
           
            {% endfor %}       
          </tbody>
      </table>
  </div>
</div>




<section class="container">
<div class="container-fluid">
<div class="row-fluid">
  <div class="span12">
    <div class="widget-box">
      <div class="widget-title">
         <!-- <span class="icon"><i class="icon-th"></i></span>  -->
        <h5>Category Offer Details</h5>
      </div>
      <div class="widget-content nopadding">
        <table class="table table-bordered data-table table-hover">
          <thead>
            <tr>
              <th>Coupon Code</th>
              <th>Category</th>
              <th>Valid From</th>
              <th>Valid To</th>
              <th>Discount</th>
              <th>Edit</th>
              <th>Block/Activate</th>
                <!-- <th>Edit User</th> -->
                <th>Delete</th>
              <!-- <th>Offer Active</th> -->
              
            </tr>
          </thead>
          <tbody>
            {% for offer in cat_offers %}
            <tr class="gradeX">
              
              <td>{{offer.code}}</td>
              <td>{{offer.category_id.category_name}}</td>
              <td>{{offer.valid_from | naturaltime}}</td>
              <td>{{offer.valid_to | naturaltime}}</td>
              <td>{{offer.discount}}</td>
              <td> <a href="{% url 'edit_cat_offer' offer.id %}" class="btn btn-primary">Edit</a></td>
              {% if offer.is_active %}
              <td><a class="confirm-block" id="blockCatOfferBtn"
                onclick="blockCatOffer('{{offer.id}}')">
                <button class="btn btn-warning"> <i class="icon-ban-circle"></i>Deactivate</button> </a></td>
              {% else %}
              <td><a class="confirm-activate" id="actCatOfferBtn" onclick="actCatOffer('{{offer.id}}')"><button class="btn btn-success"> <i class="icon-play"></i>Activate</button></a></td>
              {% endif %}
              <!-- <td><a href="admin_user_edit/{{user.id}}" onclick="return confirm('Are you sure you want to EDIT this user?')"><button class="btn btn-primary "> <i class="icon-edit"></i> Edit</button></a></td> -->
              <td><a  class="confirm-delete" id="delCatOfferBtn" onclick="delCatOffer('{{offer.id}}')" >  <button class="btn btn-danger"> <i class="icon-trash"></i> Delete </button></a></td>
              <!-- <td class="center">4</td> -->
              
            </tr>
            {% endfor %}
         
            
          </tbody>
        </table>
      </div>
    </div>
</div>
</div>


<div class="row-fluid">
  <div class="span12">
    <div class="widget-box">
      <div class="widget-title">
         <!-- <span class="icon"><i class="icon-th"></i></span>  -->
        <h5>Product Offer Details</h5>
      </div>
      <div class="widget-content nopadding">
        <table class="table table-bordered data-table table-hover">
          <thead>
            <tr>
              <th>Coupon Code</th>
              <th>Product</th>
              <th>Valid From</th>
              <th>Valid To</th>
              <th>Discount</th>
              <th>Edit</th>
              <!-- <th>Offer Active</th> -->
                <th>Block/Activate</th>
                <!-- <th>Edit User</th> -->
                <th>Delete</th>
              <!-- <th>Offer Active</th> -->
              
              
            </tr>
          </thead>
          <tbody>
            {% for offer in prod_offers %}
            <tr class="gradeX">
              
              <td>{{offer.code}}</td>
              <td>{{offer.product_id.product_name}}</td>

              <td>{{offer.valid_from | naturaltime}}</td>
              <td>{{offer.valid_to | naturaltime}}</td>
              <td>{{offer.discount}} </td>
              <td> <a href="{% url 'edit_product_offer' offer.id %}" class="btn btn-primary">Edit</a></td>

             {% if offer.is_active %}
              <td><a class="confirm-block" id="blockProdOfferBtn"
                onclick="blockProOffer('{{offer.id}}')">
                <button class="btn btn-warning"> <i class="icon-ban-circle"></i> Block </button> </a></td>
              {% else %}
              <td><a class="confirm-activate" id="actProdOfferBtn" onclick="actProOffer('{{offer.id}}')"><button class="btn btn-success"> <i class="icon-play"></i> Activate Offer</button></a></td>
              {% endif %}
              <!-- <td><a href="admin_user_edit/{{user.id}}" onclick="return confirm('Are you sure you want to EDIT this user?')"><button class="btn btn-primary "> <i class="icon-edit"></i> Edit</button></a></td> -->
              <td><a  class="confirm-delete" id="delProOfferBtn" onclick="delProOffer('{{offer.id}}')" >  <button class="btn btn-danger"> <i class="icon-trash"></i> Delete </button></a></td>
              <!-- <td class="center">4</td> -->
              
            </tr>
            {% endfor %}
         
            
          </tbody>
        </table>
      </div>
    </div>
</div>
</div>


</div>
<nav class="mt-4" aria-label="Page navigation sample">
	{% if coupon_offers.has_other_pages %}
  	<ul class="pagination">
	{% if coupon_offers.has_previous %}
		<li class="page-item"><a class="page-link" href="?page={{coupon_offers.previous_page_number}}">Previous</a></li>
	{% else %}
		<li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
	{% endif %}
	{% for i in coupon_offers.paginator.page_range %}
		{% if coupon_offers.number == i %}
			<li class="page-item active"><a class="page-link" href="#">{{i}}</a></li>
		{% else %}
			<li class="page-item"><a class="page-link" href="?page={{i}}">{{i}}</a></li>
		{% endif %}
	{% endfor %}
	{% if coupon_offers.has_next %}
	<li class="page-item"><a class="page-link" href="?page={{coupon_offers.next_page_number}}">Next</a></li>
	{% else %}
	<li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
	{% endif %}
	</ul>
	{% endif %}
</nav>


</section>







<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<script>

function blockCoupon(couponId){
  var data = {'couponId' : couponId}

  Swal.fire({
    title: 'Are you sure?',
    text: "This will block the offer related to this coupon.",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Deactivate'
  }).then((result) => {
    if (result.isConfirmed) {
      $.ajax({
        method: "GET",
        url: "{% url 'block_coupon' %}",
        data : data,
        success:function(response){
          Swal.fire(
            'Coupon Deactivated',
            'The selected coupon successfully deactivated.',
            'success'
          )
        location.reload();

        }
      })
     
    }
  })
}


function actCoupon(couponId){
  var data = { 'couponId' : couponId}
  
  Swal.fire({
    title: 'Activate this offer',
    text: "You are going to activate this offer",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Activate User.!'
  }).then((result) => {
    if (result.isConfirmed) {
      $.ajax({
        method: "GET",
        url: "{% url 'activate_coupon' %}",
        data : data,
        success:function(response){
         
          Swal.fire(
            'Coupon Activated',
            'Coupon has been successfully activated.',
            'success'
          )
        location.reload();

        }
      })
     
    }
  })
}

function delCoupon(couponId){
  var data = { 'couponId' : couponId}
  
  Swal.fire({
    title: 'Delete this offer !',
    text: "Are you sure? You will not be able to revert this..",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Delete Coupon.'
  }).then((result) => {
    if (result.isConfirmed) {
      $.ajax({
        method: "GET",
        url: "{% url 'delete_coupon' %}",
        data : data,
        success:function(response){
         
          Swal.fire(
            'User Deleted',
            'User has been successfully Deleted.',
            'success'
          )
        location.reload();

        }
      })
     
    }
  })
}


{% comment %} product offer section {% endcomment %}


function blockProOffer(proOffId){
  var data = {'proOffId' : proOffId}
 
  Swal.fire({
    title: 'Are you sure?',
    text: "This will block the offer related to this coupon.",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Deactivate'
  }).then((result) => {
    if (result.isConfirmed) {
      $.ajax({
        method: "GET",
        url: "{% url 'block_product_offer' %}",
        data : data,
        success:function(response){
          Swal.fire(
            'Coupon Deactivated',
            'The selected coupon successfully deactivated.',
            'success'
          )
        location.reload();

        }
      })
     
    }
  })
}


function actProOffer(proOffId){
  var data = { 'proOffId' : proOffId}
  
  Swal.fire({
    title: 'Activate this offer',
    text: "You are going to activate this offer",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Activate'
  }).then((result) => {
    if (result.isConfirmed) {
      $.ajax({
        method: "GET",
        url: "{% url 'activate_product_offer' %}",
        data : data,
        success:function(response){
         
          Swal.fire(
            'Offer Activated',
            'Offer has been successfully activated.',
            'success'
          )
        location.reload();

        }
      })
     
    }
  })
}

function delProOffer(proOffId){
  var data = { 'proOffId' : proOffId}
  
  Swal.fire({
    title: 'Delete this offer !',
    text: "Are you sure? You will not be able to revert this..",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Delete'
  }).then((result) => {
    if (result.isConfirmed) {
      $.ajax({
        method: "GET",
        url: "{% url 'delete_product_offer' %}",
        data : data,
        success:function(response){
         
          Swal.fire(
            'Offer Deleted',
            'Offer has been successfully Deleted.',
            'success'
          )
        location.reload();

        }
      })
     
    }
  })
}



{% comment %} category offer section {% endcomment %}


function blockCatOffer(catOffId){
  var data = {'catOffId' : catOffId}
 
  Swal.fire({
    title: 'Are you sure?',
    text: "This will block the offer related to this coupon.",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Deactivate'
  }).then((result) => {
    if (result.isConfirmed) {
      $.ajax({
        method: "GET",
        url: "{% url 'block_cat_offer' %}",
        data : data,
        success:function(response){
          Swal.fire(
            'Coupon Deactivated',
            'The selected coupon successfully deactivated.',
            'success'
          )
        location.reload();

        }
      })
     
    }
  })
}


function actCatOffer(catOffId){
  var data = { 'catOffId' : catOffId}
  
  Swal.fire({
    title: 'Activate this offer',
    text: "You are going to activate this offer",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Activate'
  }).then((result) => {
    if (result.isConfirmed) {
      $.ajax({
        method: "GET",
        url: "{% url 'activate_cat_offer' %}",
        data : data,
        success:function(response){
         
          Swal.fire(
            'Offer Activated',
            'Offer has been successfully activated.',
            'success'
          )
        location.reload();

        }
      })
     
    }
  })
}

function delCatOffer(catOffId){
  var data = { 'catOffId' : catOffId}
  
  Swal.fire({
    title: 'Delete this offer !',
    text: "Are you sure? You will not be able to revert this..",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#3085d6',
    cancelButtonColor: '#d33',
    confirmButtonText: 'Delete'
  }).then((result) => {
    if (result.isConfirmed) {
      $.ajax({
        method: "GET",
        url: "{% url 'delete_cat_offer' %}",
        data : data,
        success:function(response){
         
          Swal.fire(
            'Offer Deleted',
            'Offer has been successfully Deleted.',
            'success'
          )
        location.reload();

        }
      })
     
    }
  })
}

</script>



{% endblock %}